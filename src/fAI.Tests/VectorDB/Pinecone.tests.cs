using System.IO;
using System.Collections.Generic;
using System.Text.RegularExpressions;
using System.Linq;
using System;
using fAI;
using Xunit;
using static fAI.OpenAICompletions;
using System.Runtime.InteropServices;
using System.Diagnostics;
using Newtonsoft.Json;
using DynamicSugar;
using static System.Net.Mime.MediaTypeNames;
using static fAI.OpenAICompletionsEx;
using fAI.VectorDB;
using static Azure.Search.Documents.Indexes.Models.LexicalAnalyzerName;
using Azure;

namespace fAI.Tests
{
    [Collection("Sequential")]
    [CollectionDefinition("Sequential", DisableParallelization = true)]
    public class PineconeTests : OpenAiCompletionsBase
    {
        const string indexName = "unit-test-index";

        const string HelloWorld_TEXT = "Hello world.";
        List<float> HelloWorld_VECTOR = new List<float>() { 0.002331425f, -0.001407938f, -0.01621639f, -0.02871015f, -0.009223708f, -0.00341666f, -0.01830718f, 0.008127317f, -0.007732106f, -0.01949281f, 0.02044897f, -0.0009434062f, -0.02556121f, -0.007336895f, 0.005995092f, -0.003850117f, 0.02623689f, -0.01227703f, 0.01369214f, 0.01770799f, -0.01652236f, -0.007011803f, 0.006514602f, 0.001896374f, -0.007853219f, 0.006839695f, 0.01698131f, -0.0156172f, 0.03679284f, -0.02623689f, 0.002538591f, -0.01250651f, -0.007458008f, -0.01259575f, 0.001484431f, -0.01426583f, 0.01119976f, -0.01773349f, 0.01719804f, -0.01253838f, 0.007967957f, 0.003999915f, 0.004325008f, -0.008222932f, -0.02863365f, 0.01698131f, -0.001944182f, -0.01648411f, -0.008618143f, 0.02521699f, 0.01736377f, -0.002025455f, -0.01329693f, 0.01297184f, -0.006871567f, -0.003083599f, -0.03189733f, 0.02233578f, 0.03485503f, -0.020143f, 0.01204755f, 0.007712983f, -0.01271686f, -0.006667587f, -0.003179215f, 0.02115015f, 0.002766475f, 0.007215783f, -0.02274374f, 0.02738428f, 0.02743527f, -0.001874064f, -0.002763288f, -0.007081921f, 0.01675183f, 0.006463607f, -0.01745301f, -0.003242959f, 0.004857267f, -0.002208718f, 0.0191486f, -0.02952606f, -0.009026103f, 0.01401086f, 0.02510225f, -0.001551361f, -0.005838919f, 0.01111689f, -0.01593591f, -0.01837092f, 0.01319494f, 0.006852444f, 0.01496701f, 0.0108428f, -0.01334792f, 0.007464383f, 0.003222242f, 0.01990077f, -0.003811871f, -0.04887864f, -0.01153123f, -0.01227703f, -0.01030735f, -0.01058782f, -0.007209408f, 0.008165563f, -0.004761652f, -0.001241408f, 0.03847567f, 0.007362393f, -0.01890637f, 0.009593421f, -0.0003633389f, -0.03332519f, -0.002329831f, -0.005395901f, -0.004172022f, -0.001161728f, -0.009778278f, -0.01587217f, 0.02024499f, 0.02886313f, 0.01974779f, -0.03289173f, 0.005915412f, 0.004755277f, -0.03365665f, -0.01167784f, 0.006795074f, -0.01297821f, 0.03069895f, 0.006272376f, 0.01527298f, 0.003461281f, -0.03166785f, 0.02205531f, -0.007400639f, 0.03023999f, -0.01402361f, -0.003046947f, 0.01336067f, 0.02049996f, 0.009223708f, -0.02176209f, -0.007904214f, 0.009472308f, 0.006858818f, -0.02098441f, 0.01698131f, -0.01537497f, 0.01272323f, 0.01607615f, 0.004599105f, -0.004675597f, 0.01392162f, 0.01657335f, 0.002661298f, 0.02769025f, 0.004879577f, -0.01281885f, -0.0007633303f, 0.003674822f, 0.004315446f, -0.03365665f, 0.005501078f, 0.01420209f, 0.02047446f, 0.004066845f, -0.01064519f, -0.03036748f, -0.01848566f, 0.02455406f, -0.03778724f, 0.02850617f, -0.01000775f, 0.01046671f, -0.006001465f, 0.01802671f, -0.009720908f, -0.01861315f, -0.03610441f, 0.008076322f, 0.01384512f, 0.02282023f, 0.007566372f, -0.004207082f, 0.01200293f, -0.01911035f, -0.000522698f, -0.01699406f, 0.02779224f, 0.03768525f, 0.02384013f, 0.01163959f, -0.6894515f, -0.008911364f, 0.02228478f, 0.02543372f, 0.00808907f, 0.004726592f, 0.01993902f, 0.03143837f, -0.007171162f, 0.02186408f, -0.02289672f, 0.01866414f, -0.01154398f, -0.01024998f, 0.003840556f, -0.009861144f, 0.002275649f, -0.01257025f, -0.01872789f, 0.01759325f, -0.00197446f, 0.03029099f, -0.02602016f, -0.00839504f, 0.01090654f, 0.01568094f, 0.005395901f, -0.01279335f, -0.01111689f, 0.02751176f, -0.0150945f, 0.01429133f, 0.0001527856f, 0.008082696f, 0.06058197f, 0.006501853f, -0.007496255f, 0.001840598f, 0.01241089f, 0.02234853f, -0.01148023f, -0.01466104f, 0.005893101f, -0.01165872f, -0.0002715082f, 0.01390887f, 0.006039712f, -0.002395168f, 0.003751314f, 0.005341719f, 0.01599966f, -0.005293911f, 0.01356465f, 0.01587217f, -0.008165563f, 0.009995006f, 0.02445207f, 0.007763978f, -0.007834096f, 0.01542597f, -0.001998364f, 0.01700681f, -0.002082824f, 0.008446035f, -0.02455406f, 0.01644586f, -0.02047446f, 0.0128316f, 0.0006621373f, -0.003885176f, -0.005720994f, -0.004229392f, -0.01764425f, -0.01026273f, 0.01049221f, 0.02779224f, 0.01468654f, -0.008707385f, -0.006125766f, 0.02191507f, 0.02334293f, 0.01381963f, -0.01677733f, -0.01848566f, 0.02980654f, -0.01620364f, -0.03748127f, -0.01289534f, 0.006877941f, 0.003451719f, 0.02445207f, -0.00119599f, -0.01147386f, -0.01801396f, 0.0321778f, 0.003400724f, -0.01125713f, 0.009657165f, 0.02209355f, -0.001209536f, 0.008898615f, 0.0006318591f, 0.008280301f, 0.00485408f, 0.01200293f, -0.0003296743f, -0.01177983f, 0.02960256f, 0.01831993f, -0.02419709f, 0.007916963f, 0.006775951f, -0.03569645f, 0.03123439f, 0.001266905f, -0.03092842f, 0.003225429f, 0.01712155f, 0.01752951f, -0.02524249f, 0.02465605f, 0.008324922f, 0.01214954f, 0.001501163f, -0.00133543f, 0.0005876369f, 0.003188777f, 0.010097f, -0.008165563f, 0.0005422195f, 0.01777173f, -0.001162525f, 0.004819021f, -0.006266002f, 0.00543096f, 0.01334792f, 0.01108502f, -0.01991352f, 0.01243639f, 0.02491102f, -0.01134637f, -0.004857267f, -0.01132725f, 0.002012706f, 0.01100216f, -0.0206402f, -0.01000775f, 0.004653287f, 0.005794299f, -0.01449531f, 0.01374313f, -0.004828583f, -0.02748627f, 0.02085693f, -0.006476356f, -0.004347318f, 0.01647136f, -0.0302145f, -0.03641038f, -0.02352141f, 0.004085969f, 0.02131588f, -0.01269136f, 0.004309072f, -0.0072859f, -0.01715979f, -0.02952606f, 0.01012249f, 0.005720994f, -0.03579844f, 0.009026103f, -0.02139237f, -0.01996451f, -0.002501939f, 0.001351366f, 0.009491432f, -0.01492877f, -0.01580843f, -0.001703549f, -0.02122664f, 0.006763203f, -0.01978603f, -0.01086829f, 0.0001325669f, 0.0272058f, -0.01747851f, -0.004901887f, 0.02554846f, -0.01587217f, 0.01116789f, 0.0065401f, 0.004838144f, -0.03006151f, -0.005354467f, -0.0105687f, -0.004309072f, 0.002377639f, -0.004917823f, 0.01766974f, 0.01282522f, 0.01960755f, 0.005370404f, 0.01548971f, -0.03500802f, -0.01246826f, -0.02970455f, -0.002414291f, -0.02886313f, 0.01190732f, 0.01040934f, 0.0103456f, -0.003075632f, 0.01065157f, 0.01538772f, 0.01102765f, 0.03230529f, -0.0006908219f, -0.01393436f, -0.02316445f, -0.006571971f, 0.00372263f, 0.01225153f, -0.01297821f, -0.002312301f, 0.01635662f, 0.02807271f, -0.001960118f, 0.03954657f, 0.0002077645f, -0.02845517f, -0.02369989f, 0.006852444f, 0.01750401f, 0.01927608f, -0.01686657f, -0.01040297f, 0.01635662f, -0.02195332f, 0.02553571f, 0.01616539f, -0.01216866f, 0.0118117f, 0.0271548f, -0.0211374f, 0.01742752f, 0.03587493f, 0.008777502f, -0.01315669f, 0.001931433f, 0.03097942f, -0.006807823f, 0.004477992f, -0.0140491f, -0.006157638f, 0.002173659f, -0.03284073f, 0.0003740956f, -0.02692532f, 0.02886313f, 0.0392406f, 0.006141702f, 0.01534947f, 0.007655614f, -0.007744855f, 0.007751229f, -0.01577018f, 0.004372815f, -0.007254029f, -0.002627832f, -0.01432958f, -0.01941632f, -0.002847748f, 0.01897011f, -0.02299871f, 0.0166371f, 0.004226205f, -0.00610983f, -0.008305799f, 0.001028663f, 0.0003958083f, -0.01508175f, -0.01282522f, -0.002062107f, 0.009822899f, 0.003489965f, -0.0150945f, -0.02372539f, -0.001281248f, 0.006444484f, -0.002748945f, -0.01840917f, 0.007324147f, 0.01699406f, -0.02542097f, 0.006285125f, 0.0005549683f, 0.01424033f, 0.009842021f, -0.007107418f, -0.008650015f, 0.02168559f, 0.0150945f, -0.002146568f, -0.01109777f, 0.009395815f, 0.005666811f, -0.01011612f, -0.02415885f, -0.002911492f, -0.001527457f, -0.009338446f, 0.009599796f, -0.002932208f, 0.001302761f, 0.00864364f, 0.001509928f, -0.0003143359f, 0.01597416f, 0.01988802f, 0.004309072f, -0.009204585f, -0.01020536f, -0.02357241f, -0.003276424f, 0.07016902f, 0.0001420288f, -0.003792748f, 0.01501801f, -0.01687932f, -0.005313034f, -0.03765976f, -0.01243639f, -0.003591955f, 0.0009888236f, 0.00038047f, -0.008548025f, -0.01200293f, 0.02157086f, 0.01348816f, 0.002850935f, -0.005937722f, -0.02470704f, -0.009714534f, 0.009414939f, -0.01245551f, 0.0001723071f, 0.0004274809f, 0.007872342f, 0.01714705f, 0.004895513f, 0.00845241f, 0.02837868f, -0.003483591f, -0.008216558f, 0.0130802f, -0.004544923f, 0.01434232f, 0.01252563f, 0.0126085f, 0.02435008f, -0.0001356545f, 0.04184134f, 0.005379965f, -0.007126541f, 0.01327143f, 0.01219416f, -0.0007019771f, -0.001762512f, 0.01613989f, -0.0004238953f, -0.006049274f, 0.02206806f, -0.01058145f, -0.03082643f, 0.01772074f, -0.001635025f, -0.01616539f, -0.02799622f, -0.01214954f, 0.01111689f, -0.006135327f, -0.004442933f, -0.009325698f, -0.01164597f, -0.01196469f, -0.009370319f, -0.02350866f, -0.005118616f, -0.0382462f, -0.02052546f, -0.0271038f, -0.0004262857f, -0.01675183f, 0.001565704f, -0.009695411f, -0.02641537f, -0.01475028f, -0.00294177f, 0.02148161f, 0.004031787f, -0.007164788f, 0.005364029f, 0.009172712f, 0.01548971f, 0.004229392f, -0.03143837f, 0.00454811f, -0.002078043f, 0.01429133f, 0.008560774f, -0.005520201f, 0.01028185f, -0.02276924f, 0.02807271f, 0.01500526f, 0.009593421f, 0.02496202f, -0.001259734f, 0.01522199f, 0.006979931f, 0.002046172f, -0.0007278729f, -0.01016711f, -0.002388794f, -0.007056423f, -0.01248101f, 0.0007270761f, 0.003035792f, -0.001695581f, 0.01598691f, 0.01116152f, 0.0216091f, -0.02248876f, -0.0007318569f, 0.02293497f, -0.02891413f, 0.02228478f, -0.01146111f, -0.0004430184f, 0.01759325f, 0.01597416f, 0.03523749f, -0.008796625f, -0.03786374f, -0.01320769f, -0.02497477f, 0.01072168f, 0.02405686f, 0.0186004f, -0.0008708978f, 0.003203119f, -0.02197881f, -0.004921011f, -0.01201568f, -0.004121028f, 0.01679008f, -0.006724956f, -0.006418987f, -0.01077905f, -0.002669266f, -0.0007908198f, 0.001498773f, 0.0005382355f, -0.01534947f, -0.02185133f, -0.01246189f, -0.004736154f, -0.01664984f, -0.04275925f, -0.03982704f, -0.01752951f, 0.003246146f, -0.009567924f, 0.02143062f, -0.005510639f, -0.002742571f, -0.01188182f, -0.005013439f, 0.001414313f, -0.02758826f, -0.0009593421f, -0.01239814f, 0.02345767f, 0.01565544f, 0.01395986f, 0.01670084f, 0.01047946f, 0.01440607f, -0.00247166f, -0.01113602f, 0.002476441f, -0.01533672f, -0.02024499f, 0.005944096f, 0.01834542f, 0.02835318f, -0.002975235f, 0.006979931f, 0.01262762f, -0.00384693f, -0.01899561f, 0.00631381f, -0.01826893f, -0.009861144f, -0.02641537f, 0.004697908f, -0.006090707f, 0.01002688f, 0.02125214f, -0.01299733f, 0.01189457f, 0.009593421f, 0.01673909f, 0.007336895f, 0.03230529f, -0.01903386f, 0.03059696f, 0.01162684f, 0.01571919f, -0.01145474f, 0.002554527f, -0.003649325f, 0.01328418f, 0.009179087f, 0.01264674f, 0.0127806f, -0.01589767f, -0.01690482f, 0.005838919f, 0.02873564f, 0.003894738f, 0.01499251f, 0.01050496f, -0.009038852f, 0.005284349f, -0.0175805f, 0.008713759f, -0.01129538f, 0.0005709042f, -0.008630891f, -0.02104816f, 0.02435008f, -0.01870239f, -0.020092f, -0.006597469f, 0.0005179173f, 0.03768525f, -0.0004374409f, 0.02644087f, 0.01402361f, 0.00224059f, -0.003231804f, 0.02424809f, -0.01497976f, -0.009478683f, 0.04110191f, -0.007407013f, -0.01209855f, -0.02896512f, -0.006846069f, 0.001654148f, -0.01146111f, -0.02947507f, 0.008611768f, 0.02995952f, -0.002787192f, -0.01737652f, 0.01730003f, -0.04275925f, 0.02224654f, 0.003349729f, -0.01687932f, -0.01722354f, 0.00557757f, -0.02853166f, 0.005048498f, -0.03592593f, 0.02952606f, 0.03615541f, -0.009740031f, -0.005338531f, -0.001540206f, 0.0002589586f, -0.006680336f, -0.01485227f, 0.02544647f, -0.01286347f, 0.005472393f, 0.01786097f, 0.001059738f, -0.02644087f, 0.0008764754f, -0.007783101f, 0.02664485f, -0.02501301f, 0.0005517811f, -0.01116789f, 0.01223878f, 0.001526661f, 0.01513274f, -0.007413388f, -0.01613989f, -0.003815058f, -0.01035834f, 0.03077544f, -0.00516005f, -0.0009083472f, -0.01171608f, -0.01140374f, -0.02848067f, -0.04569146f, 0.0003035792f, 0.004825395f, -0.03052047f, -0.008280301f, -0.01053045f, 0.005692309f, 0.01642037f, 0.009166338f, -0.01332243f, 0.01728728f, 0.02071669f, -0.02261625f, -0.002317082f, 0.009395815f, 0.01945456f, -0.0271803f, 0.01378138f, -0.008305799f, -0.02081868f, 0.001862908f, -0.02126488f, -0.003160092f, 0.003120252f, 0.004442933f, 0.004787149f, -0.01628013f, 0.004411061f, 0.02740978f, 0.02004101f, 0.01575743f, -0.005599881f, -0.005064434f, 0.03551797f, -0.01132087f, 0.001560923f, -0.009459559f, -0.008936862f, 0.01782273f, -0.001929839f, 0.003276424f, -0.000193721f, -0.02127763f, -0.011289f, -0.001644586f, 0.01248738f, 0.01445706f, -0.02070394f, -0.03434508f, -0.0118627f, -0.02794522f, 0.004857267f, 0.01236627f, -0.01602516f, 0.008841245f, 0.01153123f, 0.008726507f, -0.002208718f, 0.004411061f, -0.008101819f, -0.01441882f, -0.007190285f, -0.02646637f, -0.01485227f, -0.006431736f, 0.03475304f, -0.00248919f, -0.01499251f, -0.0048987f, -0.01176071f, -0.03488053f, -0.02197881f, -0.002605522f, 0.01298458f, -0.006750454f, 0.01384512f, -0.005784737f, 0.03411561f, 0.01147386f, -0.00429951f, -0.009217333f, -0.02075494f, 0.00909622f, 0.0006645276f, 0.01552796f, 0.0001933226f, -0.01939082f, 0.002506719f, -0.001709924f, 0.002345767f, -0.007196659f, 0.01517099f, 0.003279611f, -0.007451634f, -0.01974779f, -0.005583945f, -0.002838186f, 0.007955209f, 0.0211629f, -0.00405091f, -0.01067069f, -1.365758E-05f, -0.005281162f, -0.008216558f, -0.006485918f, 0.004943321f, -0.02118839f, 0.01074081f, -0.02051271f, -0.003681196f, 0.005797486f, -0.02385288f, 0.02667035f, -0.01904661f, 0.008624517f, 0.02842967f, 0.01715979f, 0.01422758f, -0.01061332f, -0.003180809f, 0.00397123f, 0.01222603f, -0.008267553f, -0.003161686f, 0.002597554f, -0.001647774f, -0.02182583f, -0.03358016f, 0.002154536f, -0.01908485f, -0.01262762f, 0.003330606f, 0.03312121f, 0.01844742f, -0.03572195f, -0.01696856f, -0.01664984f, 0.01220691f, 0.01477578f, -0.01329693f, -0.006693084f, -0.01543871f, -0.008726507f, 0.02275649f, -0.00432182f, -0.002270868f, 0.01444431f, 0.01339892f, -0.008860369f, 0.03454906f, 0.2253976f, -0.008108194f, 0.004965631f, 0.02436283f, 0.01350091f, 0.02324094f, 0.01444431f, -0.00195693f, 0.01172883f, 0.01061969f, -0.01160772f, 0.001714704f, -0.008866743f, 0.005038937f, 0.002796753f, 0.01431683f, -0.0281747f, -0.02369989f, -0.0261604f, -0.02180033f, 0.00603015f, -0.0321523f, -0.02010475f, -0.01367939f, 0.01237902f, -0.01148661f, -0.01508175f, -0.0003729004f, 0.03842468f, 0.01155673f, -0.003031011f, -0.01766974f, 0.02086967f, 0.007056423f, -0.009950385f, -0.02232303f, 0.03337618f, 0.00995676f, 0.03503352f, 0.0008541651f, -0.02547197f, -0.0135519f, -0.006616592f, -0.02428634f, 0.008178311f, 0.01527298f, 0.001282841f, -0.01905935f, 0.01879163f, 0.04013301f, 0.00185016f, 0.009472308f, 0.01995177f, 0.04643088f, 0.001227862f, -0.01466104f, 0.009924888f, 0.01021811f, -0.008344045f, 0.0005438131f, -0.004025412f, 0.02585443f, -0.004223017f, 0.03482954f, -0.01823069f, 0.007808599f, -0.02352141f, -0.007317772f, 0.01431683f, -0.0001453156f, -0.01449531f, 0.002666079f, 0.008771128f, -0.01455905f, -0.03286623f, -0.009134467f, 0.0105432f, -0.0014175f, 0.03256026f, 0.03169335f, -0.001250969f, 0.001003963f, -0.005842106f, -0.02320269f, -0.03666535f, -0.03189733f, -0.004041348f, -0.01252563f, -0.02386563f, -0.0165606f, -0.01693032f, -0.0045258f, 0.002827031f, -0.00884762f, 0.0191486f, 0.0130547f, 0.00189478f, 0.008752004f, -0.02002826f, 0.009963134f, 0.0007780711f, -0.007062797f, 0.004223017f, 0.01193919f, 0.008050825f, 0.01328418f, -0.007260403f, 0.0007426136f, -0.007305024f, -0.01533672f, -0.01044759f, -0.004959257f, -0.007757604f, -0.00580386f, -0.005341719f, 0.004634164f, -0.008382292f, 0.0007720951f, 0.006973557f, -0.009631667f, -0.01037747f, -0.006616592f, -0.005491517f, 0.003451719f, 0.000682854f, -0.01698131f, -0.007993455f, 0.003579207f, 0.01536222f, -0.02540822f, 0.008018953f, 0.004962444f, 0.01853666f, 0.005038937f, -0.006948059f, -0.002874839f, 0.01132725f, -0.006565597f, -0.01954381f, -0.002908305f, -0.006221381f, -0.01351366f, 0.001883625f, -0.01185632f, -0.01156947f, -0.01154398f, 0.02942407f, -0.02433733f, -0.008375917f, 0.0160634f, -0.04117841f, -0.009045226f, -0.006412612f, -0.01234715f, 0.02628789f, -0.02053821f, -0.02672134f, -0.01654785f, -0.01276786f, 0.01596141f, -0.01854941f, 0.01512f, 0.03913861f, -0.01199018f, -0.0271548f, -0.02104816f, -0.1635917f, 0.01381963f, 0.008771128f, -0.0145463f, 0.01829443f, 0.01196469f, 0.0261604f, -0.0009768716f, -0.009159965f, 0.01707055f, 0.005223793f, -0.0107918f, -0.01184995f, -0.01297821f, 0.01135275f, -0.01988802f, -0.009644416f, 0.01081092f, 0.03125989f, 0.0245923f, 0.03148937f, -0.006858818f, -0.0005055669f, -0.004790336f, 0.02174934f, -0.009740031f, 4.636356E-05f, 0.02776674f, -0.0005358452f, -0.005526575f, -0.01620364f, -0.02299871f, 0.03447257f, -0.001904342f, 0.01598691f, -0.009459559f, 0.006199071f, -0.03574745f, -0.01353915f, 0.02401861f, 0.0382207f, 0.008752004f, 0.01325868f, -0.00789784f, -0.01707055f, -0.005045311f, 0.01923784f, 0.009478683f, 0.0190976f, -0.01166509f, -0.00178801f, 0.0007366377f, -0.002452537f, -0.01094479f, 0.01916135f, 0.0236489f, 0.002089198f, 0.01898286f, 0.004532174f, -0.01130813f, -0.00462779f, -0.004426997f, -0.008280301f, 0.0004824598f, 0.005918599f, -0.008127317f, 0.001141011f, 0.0130802f, -0.002433414f, 0.009682662f, -0.0007868358f, -0.0231262f, -0.005934535f, -0.02672134f, 0.001497179f, 0.01435507f, -0.03730279f, 0.0321523f, -0.009950385f, -0.0008422131f, 0.0004354489f, 0.001674865f, 0.002823844f, -0.0006605437f, -0.02545922f, 0.001583233f, 0.0003597533f, 0.008031702f, -0.02850617f, -0.03345267f, 0.0107663f, -0.008739256f, -0.009765529f, -0.01735102f, 0.006103456f, 0.01640762f, 0.01978603f, 0.01803946f, -0.02418434f, -0.01145474f, 0.01416384f, 0.0130802f, -0.01266587f, 0.01500526f, 0.03069895f, -0.0014175f, 0.01050496f, 0.01000775f, 0.02211905f, -0.03031649f, -0.01635662f, 0.01197106f, 0.01806495f, 0.02738428f, 0.01003325f, 0.02702731f, -0.005536137f, -0.0095488f, 0.01023086f, -0.001829443f, 0.05247378f, 0.001232643f, -0.03865416f, 0.006186322f, -0.0009999787f, 0.002834999f, -0.09311674f, -0.03564546f, 0.004063658f, 0.01505625f, -0.002015893f, 0.03472755f, 0.003668448f, -0.001367302f, 0.001124279f, -0.002027048f, -0.0006971963f, -0.02327918f, -0.01687932f, -0.01276148f, 0.03743028f, -0.03460006f, 0.01019261f, 0.0005649282f, -0.03406461f, 0.01979878f, -0.009797401f, 0.005118616f, 0.005638127f, -0.001783229f, -0.02651736f, 0.008809374f, -0.02644087f, 0.02939858f, -0.001633431f, -0.006699459f, -0.01324593f, -0.0216601f, -0.01012249f, -0.001727453f, -0.003214274f, 0.01269774f, -0.04092343f, 0.02186408f, 0.01332243f, -0.02672134f, 0.03564546f, 0.01996451f, -0.001620683f, -0.0523208f, -0.01273598f, 0.007744855f, 0.003493153f, 0.03403911f, 0.01130175f, -0.01239177f, -0.02763925f, -0.0256122f, -0.02649187f, 0.01571919f, 0.004895513f, -0.007069172f, 0.01070893f, 0.03087743f, -0.01397261f, 0.006116204f, 0.00553295f, 0.003201525f, -0.01773349f, 0.01617814f, -0.02069119f, 0.01786097f, -0.009803775f, 0.02418434f, 0.01680283f, 0.01290172f, -0.004882765f, 0.0240951f, 0.003977605f, 0.01951831f, -0.03284073f, -0.001824662f, -0.015069f, -0.02375089f, 0.01397261f, 0.001883625f, -0.02609666f, -0.02149436f, 0.006068396f, -0.005462832f, 0.02978104f, 0.008057198f, -0.0122834f, 0.009842021f, -0.004044535f, -0.03388613f, -0.02239952f, 0.002465286f, 0.01536222f, -0.0145463f, 0.004710657f, 0.008994231f, -0.007661988f, -0.008210183f, 0.01843467f, 0.01041571f, -0.01700681f, -0.01853666f, -0.05446259f, 0.03388613f, -0.02071669f, -0.02326644f, 0.003407099f, -0.01168421f, -0.001135434f, -0.02094617f, 0.001008743f, -0.00205414f, -0.01515824f, -0.003556896f, -0.008573523f, 0.01246189f, -0.02809821f, 0.005870791f, 0.01921234f, 0.01371764f, 0.0072859f, -0.004739341f, 0.0009944012f, -0.03174434f, -0.0136029f, 0.007145665f, -0.01766974f, 0.007043675f, -0.04632889f, -0.001744983f, -0.005998279f, -0.01441882f, 0.008554399f, -0.04115291f, 0.006960808f, 0.01981153f, 0.0001193202f, -0.00754725f, 0.004111466f, 0.01657335f, 0.005695496f, 0.02222104f, -0.03212681f, -0.04255527f, 0.01684107f, -0.003082006f, 0.003512276f, 0.01689207f, -0.008853994f, -0.01246826f, 0.0362319f, 0.01262762f, -0.001052567f, 0.02177483f, -0.02970455f, -0.006654838f, -0.02253976f, -0.006492292f, -0.01629288f, 0.001815101f, -0.0005995888f, -0.05137739f, 0.02644087f, 0.005896288f, 0.0261859f, -0.0120858f, 0.00429951f, 0.01714705f, -0.0155662f, -0.003875615f, -0.01828168f, -0.02572694f, -0.009185461f, -0.00650504f, 0.003805496f, 0.01118701f, 0.03176984f, 0.01842192f, -0.001022289f, 0.01412559f, -0.0392406f, 0.03187183f, 0.02180033f, 0.02038522f, -0.02607116f, 0.01022448f, 0.03388613f, 0.004140151f, -0.003560083f, -0.01195831f, -0.00397123f, 0.0047744f, -0.03730279f, -0.01281885f, 0.002685202f, 0.03256026f, -0.004675597f, -0.000827074f, 0.0140746f, -0.001737015f, 0.01833268f, 0.02424809f, -0.007311398f, 0.01168421f, -0.01670084f, -0.002460505f, -0.01144836f, 0.005023f, -0.007923337f, -0.03225429f, -0.008076322f, 0.01070893f, 0.003142562f, 0.02396762f, -0.006125766f, 0.01058782f, -0.02529348f, -0.001619886f, 0.02825119f, -0.001622276f, -0.03240728f, 0.03370765f, -0.01023723f, -0.008082696f, 0.03156586f, -0.02794522f, 0.01217504f, -1.751706E-05f, -0.01721079f, -0.009963134f, 0.02524249f, -0.01361565f, 0.01740202f, -0.005851668f, -0.01766974f, -0.01654785f, -0.003987166f, -0.0009218927f, -0.01469929f, 0.02454131f, -0.01520924f, 0.05691034f, 0.001635025f, -0.01172883f, 0.02162185f, 0.01249376f, 0.01967129f, 0.02427359f, 0.01580843f, -0.004975193f, -0.01775898f, -0.01523473f, 0.007311398f, 0.001309135f, -0.02644087f, -0.01306745f, 0.01297821f, -0.01821794f, 0.01037747f, -0.01774624f, 0.01594866f, 0.01477578f, 0.00839504f, 0.02835318f, 0.005736929f, -0.01675183f, -0.01629288f, 0.01418934f, 0.00454811f, -0.01534947f, -0.01933983f, 0.02067844f, 0.001915497f, 0.001955337f, -0.01469929f, 0.00608752f, 0.01487777f, -0.00565725f, -0.002895556f, 0.001937807f, 0.009274703f, 0.0131057f, 0.000196211f, -0.02060195f, -0.02832768f, 0.01013524f, -0.008911364f, -0.02626239f, -0.008981482f, -0.01077268f };

        public PineconeTests()
        {
            OpenAI.TraceOn = true;
        }

        [Fact()]
        [TestBeforeAfter]
        public void CreateIndex()
        {
            var client = new PineconeDB();
            client.CreateIndex(indexName);
        }

        [Fact()]
        [TestBeforeAfter]
        public void DescribeIndex()
        {
            var client = new PineconeDB();
            var index = client.DescribeIndex(indexName);
        }

        [Fact()]
        [TestBeforeAfter]
        public void CheckIndex()
        {
            var client = new PineconeDB();
            var index = client.DescribeIndex(indexName);
            index = client.CheckIndex(index);
            Assert.True(index.totalVectorCount > 0);
        }

        [Fact()]
        [TestBeforeAfter]
        public void Upsert()
        {
            var client = new PineconeDB();
            var index = client.DescribeIndex(indexName);
            var r1 = client.UpsertVectors(index,
                DS.List("1"),
                new List<List<float>>() {
                    HelloWorld_VECTOR
                },
                new List<Dictionary<string, object>>()
                {
                    DS.Dictionary(new { text = HelloWorld_TEXT  })
                }
            ); ;
            Assert.Equal(1, r1.upsertedCount);

            var r2 = client.UpsertVectors(index,
                DS.List("2"),
                new List<List<float>>() {
                    HelloWorld_VECTOR
                },
                new List<Dictionary<string, object>>()
                {
                    DS.Dictionary(new { text = HelloWorld_TEXT  })
                }
            );
            Assert.Equal(1, r2.upsertedCount);
        }

        [Fact()]
        [TestBeforeAfter]
        public void DeleteIndex()
        {
            var client = new PineconeDB();
            var r = client.DeleteIndex(indexName);
        }
    }
}
